Bootstrap: docker
From: continuumio/miniconda3

%labels
    Version v1.0

%environment
    # Activate the conda environment by default
    export PATH="/opt/conda/envs/scyard/bin:$PATH"

%post
    # Update package lists
    apt-get update

    # Install GCC and other essential build tools
    apt-get install -y build-essential gcc g++ make

    # Install additional dependencies if required
    apt-get install -y libffi-dev libssl-dev

    # Clean up to reduce image size
    apt-get clean && rm -rf /var/lib/apt/lists/*

    # Install Mamba for faster environment creation
    /opt/conda/bin/conda install mamba -n base -c conda-forge -y

    # Update conda using mamba
    /opt/conda/bin/mamba update -n base -c defaults conda -y

    # Create the conda environment using mamba
    /opt/conda/bin/mamba env create -f /app/environment.yml

    # Ensure the environment is activated by default
    echo "source activate scyard" >> /root/.bashrc

%files
    # Copy your application files into /app inside the container
    . /app

%runscript
    #!/bin/bash
    # Activate the conda environment and run the main.py script with passed arguments
    exec /opt/conda/bin/conda run --no-capture-output -n scyard python /app/main.py "$@"
